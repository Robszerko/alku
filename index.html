<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áll az Alku - Csavaros Kiadás</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@300;400;700&display=swap');

        :root {
            --hatter-szin: #111827; --taska-piros: #B92525; --taska-piros-mely: #8C1C1C;
            --taska-nyitott-szin: #374151; --szoveg-szin: #f3f4f6; --arany: #ca8a04;
            --penzfa-aktiv-alacsony: #16a34a; --penzfa-aktiv-magas: #ea580c;
            --penzfa-kiesett: #be123c; --ajanlat-szin: #059669; --rejtely-szin: #8b5cf6;
        }

        body {
            font-family: 'Roboto', sans-serif; background-color: var(--hatter-szin);
            color: var(--szoveg-szin); margin: 0; padding: 10px; font-size: 14px;
        }

        .container { max-width: 1600px; margin: 0 auto; }
        header { text-align: center; border-bottom: 2px solid var(--arany); padding-bottom: 10px; margin-bottom: 15px; }
        header h1 { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: var(--arany); text-transform: uppercase; letter-spacing: 2px; margin: 0; }
        
        #ido-kontener { font-size: 0.9rem; color: #9ca3af; margin-top: 5px; }
        #frissites-gomb { background-color: var(--arany); color: black; border: none; border-radius: 5px; padding: 5px 10px; font-weight: bold; cursor: pointer; margin-left: 10px; }

        .jatekterulet { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        #penzfa-kontenerek { display: flex; justify-content: space-between; width: 100%; order: 1; }
        .penzfa-kontener { list-style: none; padding: 0; margin: 0; width: 48%; }
        .penzfa-kontener li { padding: 4px 8px; margin: 3px 0; border-radius: 5px; text-align: center; font-weight: 700; transition: all 0.5s ease; color: #000; font-size: 0.75rem; }
        
        .penzfa-elem.aktiv.tipus-penz-alacsony, .penzfa-elem.aktiv.tipus-vicc, .penzfa-elem.aktiv.tipus-targy-alacsony { background-color: var(--penzfa-aktiv-alacsony); }
        .penzfa-elem.aktiv.tipus-penz-magas, .penzfa-elem.aktiv.tipus-targy-magas { background-color: var(--penzfa-aktiv-magas); }
        .penzfa-elem.kiesett { background-color: var(--penzfa-kiesett); color: #d1d5db; text-decoration: line-through; opacity: 0.4; }

        #fő-kontener { display: flex; flex-direction: column; align-items: center; width: 100%; order: 2; }
        
        #informacios-sav { background-color: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 10px; margin-bottom: 15px; text-align: center; width: 100%; box-sizing: border-box; }
        #uzenetek { font-size: 1rem; font-weight: 700; min-height: 48px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .jatekos-taskaja-info { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }
        #kiegeszito-uzenet { font-size: 0.8rem; color: #9ca3af; font-style: italic; margin-top: 4px; }
        #bekiabalas { font-size: 0.9rem; color: var(--arany); font-weight: bold; margin-top: 5px; letter-spacing: 1px; }

        #taska-racs { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 15px; width: 100%; perspective: 1200px; }
        .taska { cursor: pointer; position: relative; aspect-ratio: 1.3 / 1; transform-style: preserve-3d; }
        .taska.animacio-nyitas { animation: shake-and-flip-anim 0.8s ease-in-out; }
        .taska.nyitott { transform: rotateY(180deg); cursor: not-allowed; transition: transform 0.8s; }

        @keyframes shake-and-flip-anim {
            0% { transform: rotateY(0) translateX(0); } 20% { transform: translateX(-5px) rotateZ(-2deg); }
            40% { transform: translateX(5px) rotateZ(2deg); } 60% { transform: translateX(0); }
            80% { transform: rotateY(90deg); } 100% { transform: rotateY(180deg); }
        }

        .taska-front, .taska-hatlap { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.3); }
        .taska-front { background: linear-gradient(145deg, var(--taska-piros), var(--taska-piros-mely)); border: 2px solid #4a0e0e; flex-direction: column; overflow: hidden; }
        .taska.rejtelyes .taska-front { background: linear-gradient(145deg, var(--rejtely-szin), #5b21b6); }
        .taska-front::before { content: ''; position: absolute; top: -5px; left: 35%; width: 30%; height: 12px; background: #c0c0c0; border-radius: 4px; border: 1px solid #555; box-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        .taska-front::after { content: ''; position: absolute; bottom: 8%; left: 10%; width: 80%; height: 5%; background: linear-gradient(#e0e0e0, #a0a0a0); }
        .taska-hatlap { background-color: var(--taska-nyitott-szin); transform: rotateY(180deg); color: white; padding: 5px; box-sizing: border-box; display: flex; flex-direction: column; }
        .taska.kivalasztott .taska-front { box-shadow: 0 0 25px var(--arany); border: 2px solid var(--arany); }
        .taska-szam { font-family: 'Orbitron', sans-serif; background-color: rgba(255, 255, 255, 0.9); color: black; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #555; z-index: 2; }
        .taska-osszeg { font-size: 0.9rem; font-weight: bold; text-align: center; }

        #dontesi-terulet { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; padding: 10px; box-sizing: border-box; }
        #dontesi-terulet h2 { font-size: 1.5rem; color: var(--arany); }
        #dontesi-terulet p { font-size: 2rem; font-weight: 700; margin: 10px 0 20px 0; font-family: 'Orbitron'; }
        .dontes-gombok { display: flex; flex-direction: column; gap: 15px; width: 80%; }
        .dontes-gomb { font-size: 1.2rem; padding: 15px 10px; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; width: 100%; }
        #alku-elfogad { background-color: var(--ajanlat-szin); color: black; }
        #alku-elutasit { background-color: var(--penzfa-kiesett); color: white; }
        .rejtett { display: none !important; }

        @media (min-width: 768px) {
            body { padding: 20px; font-size: 16px; }
            header h1 { font-size: 2.5rem; }
            #ido-kontener { font-size: 1rem; }
            .jatekterulet { flex-direction: row; gap: 30px; }
            #penzfa-kontenerek { display: contents; }
            .penzfa-kontener { width: 220px; order: initial !important; }
            #penzfa-bal { order: 0; } #fő-kontener { order: 1; } #penzfa-jobb { order: 2; }
            .penzfa-kontener li { font-size: 0.9rem; }
            #informacios-sav { padding: 15px 25px; }
            #uzenetek { font-size: 1.2rem; min-height: 60px;}
            #kiegeszito-uzenet { font-size: 1rem; }
            #taska-racs { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; }
            .taska-szam { width: 50px; height: 50px; font-size: 2rem; }
            .taska-osszeg { font-size: 1.2rem; }
            #dontesi-terulet h2 { font-size: 2rem; } #dontesi-terulet p { font-size: 3.5rem; }
            .dontes-gombok { flex-direction: row; gap: 30px; width: auto; }
            .dontes-gomb { font-size: 1.5rem; padding: 15px 30px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Áll az Alku</h1>
            <div id="ido-kontener">
                Pontos idő: <span id="pontos-ido">--:--:--</span> | 
                <span id="keveres-szoveg">Következő keverés: <span id="ido-kovetkezo">--:--</span></span>
                <button id="frissites-gomb" class="rejtett">Új Játék Indítása</button>
            </div>
        </header>

        <div class="jatekterulet">
             <ul id="penzfa-bal" class="penzfa-kontener"></ul>
            <div id="fő-kontener">
                <div id="informacios-sav">
                    <div id="uzenetek">
                        <span id="jatek-uzenet">Kérlek, válaszd ki a saját táskádat!</span>
                        <span id="kiegeszito-uzenet"></span>
                        <span id="bekiabalas"></span>
                    </div>
                    <p class="jatekos-taskaja-info">A te táskád: <span id="valasztott-taska-szam">N/A</span></p>
                </div>
                <div id="taska-racs"></div>
            </div>
             <ul id="penzfa-jobb" class="penzfa-kontener"></ul>
        </div>
    </div>

    <div id="dontesi-terulet" class="rejtett">
        <h2 id="dontes-cim">A Bankár Ajánlata:</h2>
        <p id="bankar-ajanlata">0 Ft</p>
        <div class="dontes-gombok">
            <button id="alku-elfogad" class="dontes-gomb">Áll az alku!</button>
            <button id="alku-elutasit" class="dontes-gomb">Nincs alku!</button>
        </div>
    </div>

    <script>
        const nyeremenyek = [
            { type: 'vicc', display: 'Egy Labubu', value: 1 },
            { type: 'vicc', display: 'Laci bácsi fakanala', value: 5 },
            { type: 'penz', display: '100 Ft', value: 100 },
            { type: 'vicc', display: 'Egy adag lecsó', value: 500 },
            { type: 'penz', display: '1.000 Ft', value: 1000 },
            { type: 'penz', display: '5.000 Ft', value: 5000 },
            { type: 'targy', display: 'Egy Trabant (nosztalgia)', value: 15000 },
            { type: 'targy', display: 'Kávéfőző', value: 20000 },
            { type: 'penz', display: '50.000 Ft', value: 50000 },
            { type: 'penz', display: '100.000 Ft', value: 100000 },
            { type: 'targy', display: 'Életre szóló Túró Rudi', value: 200000 },
            { type: 'penz', display: '250.000 Ft', value: 250000 },
            { type: 'penz', display: '500.000 Ft', value: 500000 },
            { type: 'penz', display: '750.000 Ft', value: 750000 },
            { type: 'penz', display: '1.000.000 Ft', value: 1000000 },
            { type: 'penz', display: '2.500.000 Ft', value: 2500000 },
            { type: 'targy', display: 'Karibi Utazás', value: 3500000 },
            { type: 'penz', display: '5.000.000 Ft', value: 5000000 },
            { type: 'penz', display: '7.500.000 Ft', value: 7500000 },
            { type: 'penz', display: '10.000.000 Ft', value: 10000000 },
            { type: 'penz', display: '15.000.000 Ft', value: 15000000 },
            { type: 'targy', display: 'Új Autó', value: 20000000 },
            { type: 'penz', display: '25.000.000 Ft', value: 25000000 },
            { type: 'penz', display: '50.000.000 Ft', value: 50000000 },
        ].sort((a, b) => a.value - b.value);

        const uzenetek = {
            sajatValasztas: ["A legfontosabb döntés! Melyik lesz az?", "Látom a szemedben a főnyereményt! Csak válaszd ki!", "Figyelj! Van egy lila táska is... Merész vagy?"],
            rejtelyesValasztva: ["Hűha! A rejtélyes táskát választottad! A bankár mostantól jobban fog figyelni rád!", "Bátor húzás! Lássuk, mit ér a lila szín szerencséje!"],
            nyitogatasKezdete: ["Remek! Most pedig derítsük ki, hol nincsenek a milliók!", "Kezdődjön a móka! Mutasd az elsőt!"],
            kicsiTalalat: ["Ez az! Egy kis érték kint van!", "Szép volt! Ezt nem siratjuk meg.", "A bankár most biztosan szomorkodik.", "Pazar! A nagyok még mind bent vannak."],
            nagyTalalat: ["Jaj ne! Ez most fájt...", "Hölgyeim és uraim... ez egy komoly veszteség.", "A bankár most pezsgőt bont, érzem.", "Nagy levegő! Menni kell tovább!"],
            legnagyobbTalalat: ["Ez... ez a főnyeremény volt. A stúdió gyászol. De a játék megy tovább!"],
            ajanlatElott: ["Csendet kérek! Mintha csörögne a telefon...", "A bankár feszülten számol, hallom a ceruza kopogását.", "Mindjárt jön az ajánlat! Készülj fel!"],
            alkuElutasitva: ["Bátor döntés! Lássuk, bejön-e a kockáztatás!", "A közönség tombol! Nincs alku, megyünk tovább!", "Ez a beszéd! A bankár most biztosan izzad."],
            ajanlatCsere: ["Figyelem, ez nem a szokásos ajánlat!", "A bankár megbolondult! Két táskát adna a tiédért!"]
        };
        
        const DOM = {
            taskaRacs: document.getElementById('taska-racs'), penzfaBal: document.getElementById('penzfa-bal'),
            penzfaJobb: document.getElementById('penzfa-jobb'), uzenetek: document.getElementById('jatek-uzenet'),
            kiegeszitoUzenet: document.getElementById('kiegeszito-uzenet'), bekiabalas: document.getElementById('bekiabalas'),
            valasztottTaskaSzam: document.getElementById('valasztott-taska-szam'), dontesiTerulet: document.getElementById('dontesi-terulet'),
            dontesCim: document.getElementById('dontes-cim'), bankarAjanlata: document.getElementById('bankar-ajanlata'),
            alkuElfogad: document.getElementById('alku-elfogad'), alkuElutasit: document.getElementById('alku-elutasit'),
            pontosIdo: document.getElementById('pontos-ido'), idoKovetkezo: document.getElementById('ido-kovetkezo'),
            frissitesGomb: document.getElementById('frissites-gomb'), keveresSzoveg: document.getElementById('keveres-szoveg'),
        };
        
        let gameState = {
            allapot: 'kezdes_elott', sajatTaska: null, taskaErtekek: {}, maradekNyeremenyek: [],
            aktualisKor: 0, megNyitando: 0, aktivJatekSeed: null, riskFactor: 1.0, rejtelyesAktiv: false
        };
        const nyitasiSzamlalo = [6, 5, 4, 3, 2, 1, 1, 1, 1, 1];

        // --- SEGÉDFÜGGVÉNYEK ---
        const mulberry32 = a => () => { let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; };
        const formatValuta = ertek => new Intl.NumberFormat('hu-HU', { style: 'currency', currency: 'HUF', maximumFractionDigits: 0 }).format(ertek);
        const getJelenlegiSeed = () => Math.floor(Date.now() / (15 * 60 * 1000));
        const kever = (tomb, seed) => { const r = mulberry32(seed); let m = tomb.length, t, i; while(m){i=Math.floor(r()*m--);t=tomb[m];tomb[m]=tomb[i];tomb[i]=t;} return tomb; };
        const getRandomElem = (tomb) => tomb[Math.floor(Math.random() * tomb.length)];
        
        function mutassUzenetet(fő, kiegeszito = "", bekiabalas = "") {
            DOM.uzenetek.textContent = fő;
            DOM.kiegeszitoUzenet.textContent = kiegeszito;
            DOM.bekiabalas.textContent = bekiabalas;
        }

        // --- JÁTÉK LOGIKA ---
        function init() {
            Object.assign(gameState, { allapot: 'sajat_valasztas', sajatTaska: null, taskaErtekek: {}, maradekNyeremenyek: [...nyeremenyek], aktualisKor: 0, aktivJatekSeed: getJelenlegiSeed(), riskFactor: 1.0, rejtelyesAktiv: false });
            DOM.valasztottTaskaSzam.textContent = "N/A";
            DOM.dontesiTerulet.classList.add('rejtett'); DOM.frissitesGomb.classList.add('rejtett'); DOM.keveresSzoveg.classList.remove('rejtett');
            mutassUzenetet(getRandomElem(uzenetek.sajatValasztas));

            const fele = Math.ceil(nyeremenyek.length / 2);
            const getTipusClass = (ny) => `tipus-${ny.type}${ny.type === 'penz' || ny.type === 'targy' ? (ny.value > 100000 ? '-magas' : '-alacsony') : ''}`;
            DOM.penzfaBal.innerHTML = nyeremenyek.slice(0, fele).map(ny => `<li data-value="${ny.value}" class="penzfa-elem aktiv ${getTipusClass(ny)}">${ny.display}</li>`).join('');
            DOM.penzfaJobb.innerHTML = nyeremenyek.slice(fele).map(ny => `<li data-value="${ny.value}" class="penzfa-elem aktiv ${getTipusClass(ny)}">${ny.display}</li>`).join('');
            
            DOM.taskaRacs.innerHTML = '';
            const kevertNyeremenyek = kever([...nyeremenyek], gameState.aktivJatekSeed);
            const rejtelyesId = Math.floor(Math.random() * nyeremenyek.length) + 1;
            for (let i = 1; i <= nyeremenyek.length; i++) {
                gameState.taskaErtekek[i] = kevertNyeremenyek[i - 1];
                const taskaElem = document.createElement('div');
                taskaElem.className = 'taska' + (i === rejtelyesId ? ' rejtelyes' : '');
                taskaElem.dataset.taskaId = i;
                taskaElem.innerHTML = `<div class="taska-front"><div class="taska-szam">${i}</div></div><div class="taska-hatlap"><div class="taska-osszeg">${kevertNyeremenyek[i-1].display}</div></div>`;
                taskaElem.addEventListener('click', () => taskaKattintas(i));
                DOM.taskaRacs.appendChild(taskaElem);
            }
        }

        function taskaKattintas(id) {
            const taskaElem = document.querySelector(`.taska[data-taska-id='${id}']`);
            if (!taskaElem || taskaElem.classList.contains('nyitott') || taskaElem.classList.contains('animacio-nyitas')) return;

            if (gameState.allapot === 'sajat_valasztas') {
                gameState.sajatTaska = id;
                taskaElem.classList.add('kivalasztott');
                DOM.valasztottTaskaSzam.textContent = id;
                if (taskaElem.classList.contains('rejtelyes')) {
                    gameState.rejtelyesAktiv = true;
                    mutassUzenetet(getRandomElem(uzenetek.rejtelyesValasztva));
                } else {
                    mutassUzenetet(getRandomElem(uzenetek.nyitogatasKezdete));
                }
                setTimeout(() => {
                    gameState.allapot = 'nyitogatas';
                    gameState.megNyitando = nyitasiSzamlalo[gameState.aktualisKor];
                    mutassUzenetet(DOM.uzenetek.textContent, `Még ${gameState.megNyitando} táskát kell kinyitnod.`);
                }, 2000);

            } else if (gameState.allapot === 'nyitogatas' && id !== gameState.sajatTaska) {
                kinyitTaska(id);
            } else if (gameState.allapot === 'alku_elfogadva_nyitogatas') {
                taskaElem.classList.add('nyitott');
                const nyeremeny = gameState.taskaErtekek[id];
                document.querySelector(`li[data-value='${nyeremeny.value}']`).classList.replace('aktiv', 'kiesett');
                if (id === gameState.sajatTaska) {
                     mutassUzenetet(DOM.uzenetek.textContent, `A te táskádban... ${nyeremeny.display} volt!`);
                }
            }
        }

        function kinyitTaska(id) {
            const taskaElem = document.querySelector(`.taska[data-taska-id='${id}']`);
            taskaElem.classList.add('animacio-nyitas');
            gameState.allapot = 'animacio';
            
            setTimeout(() => {
                taskaElem.classList.add('nyitott'); taskaElem.classList.remove('animacio-nyitas');
                const nyeremeny = gameState.taskaErtekek[id];
                document.querySelector(`li[data-value='${nyeremeny.value}']`).classList.replace('aktiv', 'kiesett');
                const atlagErtek = gameState.maradekNyeremenyek.reduce((a, b) => a + b.value, 0) / gameState.maradekNyeremenyek.length;
                gameState.maradekNyeremenyek = gameState.maradekNyeremenyek.filter(n => n.value !== nyeremeny.value);
                
                if (nyeremeny.value === nyeremenyek[nyeremenyek.length-1].value) {
                     mutassUzenetet(uzenetek.legnagyobbTalalat, `${nyeremeny.display} volt a táskában.`);
                } else if (nyeremeny.value > atlagErtek) {
                    mutassUzenetet(getRandomElem(uzenetek.nagyTalalat), `${nyeremeny.display} volt a táskában.`);
                    gameState.riskFactor = Math.min(1.5, gameState.riskFactor * 1.1);
                } else {
                    mutassUzenetet(getRandomElem(uzenetek.kicsiTalalat), `A ${nyeremeny.display} már nem a tiéd lehet.`);
                    gameState.riskFactor = Math.max(0.5, gameState.riskFactor * 0.9);
                }

                gameState.megNyitando--;
                if (gameState.megNyitando > 0) {
                    setTimeout(() => { mutassUzenetet(`Még ${gameState.megNyitando} táskát válassz...`, "", ""); }, 2000);
                    gameState.allapot = 'nyitogatas';
                } else {
                    setTimeout(() => { mutassUzenetet(getRandomElem(uzenetek.ajanlatElott)); }, 2000);
                    setTimeout(bankarAjanlatotTesz, 4500);
                }
            }, 800);
        }
        
        function bankarAjanlatotTesz() {
            const maradekTaskak = document.querySelectorAll('.taska:not(.nyitott):not(.kivalasztott)');
            if (maradekTaskak.length <= 1) { utolsoDontes(); return; }

            // Csavar: Csereajánlat esélye
            if (gameState.aktualisKor >= 2 && gameState.aktualisKor <= 4 && maradekTaskak.length >= 3 && Math.random() < 0.25) {
                bankarCsereAjanlatotTesz();
                return;
            }

            const atlag = gameState.maradekNyeremenyek.reduce((a, b) => a + b.value, 0) / gameState.maradekNyeremenyek.length;
            let ajanlatAlap = atlag * (0.15 + (gameState.aktualisKor * 0.13));
            if(gameState.rejtelyesAktiv) ajanlatAlap *= 1.2; // 20% bónusz a rejtélyes táskára
            const veglegesAjanlat = Math.round(ajanlatAlap / gameState.riskFactor / 1000) * 1000;

            DOM.dontesCim.textContent = "A Bankár Ajánlata:";
            DOM.bankarAjanlata.textContent = formatValuta(veglegesAjanlat);
            DOM.alkuElfogad.textContent = "Áll az alku!"; DOM.alkuElutasit.textContent = "Nincs alku!";
            DOM.alkuElfogad.onclick = () => alkuElfogadasa(veglegesAjanlat);
            DOM.alkuElutasit.onclick = alkuElutasitasa;
            DOM.dontesiTerulet.classList.remove('rejtett');
            gameState.allapot = 'dontes';
        }

        function bankarCsereAjanlatotTesz() {
            const maradekTaskak = Array.from(document.querySelectorAll('.taska:not(.nyitott):not(.kivalasztott)'));
            const kevert = kever([...maradekTaskak], Date.now());
            const csereTaska1 = kevert[0];
            const csereTaska2 = kevert[1];
            const id1 = csereTaska1.dataset.taskaId;
            const id2 = csereTaska2.dataset.taskaId;

            DOM.dontesCim.textContent = "A Bankár KÜLÖNLEGES Ajánlata!";
            DOM.bankarAjanlata.innerHTML = `Odaadom a(z) <strong>${id1}</strong>-es és a(z) <strong>${id2}</strong>-es táska tartalmát a tiédért cserébe!`;
            DOM.alkuElfogad.textContent = "Elfogadom a cserét!";
            DOM.alkuElutasit.textContent = "NEM, KÖSZÖNÖM!";
            DOM.alkuElfogad.onclick = () => csereElfogadasa(id1, id2);
            DOM.alkuElutasit.onclick = alkuElutasitasa;
            DOM.dontesiTerulet.classList.remove('rejtett');
            gameState.allapot = 'dontes';
        }

        function csereElfogadasa(id1, id2) {
            DOM.dontesiTerulet.classList.add('rejtett');
            const nyeremeny1 = gameState.taskaErtekek[id1];
            const nyeremeny2 = gameState.taskaErtekek[id2];
            const sajatNyeremeny = gameState.taskaErtekek[gameState.sajatTaska];
            const osszesitettNyeremeny = `${nyeremeny1.display} + ${nyeremeny2.display}`;
            
            mutassUzenetet(`CSEREELFOGADVA! A nyereményed: ${osszesitettNyeremeny}`, `A saját táskádban ez volt: ${sajatNyeremeny.display}`);
            
            document.querySelector(`.taska[data-taska-id='${id1}']`).classList.add('nyitott');
            document.querySelector(`.taska[data-taska-id='${id2}']`).classList.add('nyitott');
            document.querySelector(`.taska[data-taska-id='${gameState.sajatTaska}']`).classList.add('nyitott');

            gameState.allapot = 'vege';
        }
        
        function utolsoDontes() {
            const masikTaskaId = document.querySelector('.taska:not(.nyitott):not(.kivalasztott)').dataset.taskaId;
            DOM.dontesCim.textContent = "Az Utolsó Döntés";
            DOM.bankarAjanlata.innerHTML = `Megtartod a <strong>${gameState.sajatTaska}</strong>-ast, vagy cserélsz a <strong>${masikTaskaId}</strong>-asra?`;
            DOM.alkuElfogad.textContent = `CSERÉLEK a ${masikTaskaId}-asra!`;
            DOM.alkuElutasit.textContent = `MARADOK a ${gameState.sajatTaska}-assal!`;
            DOM.alkuElfogad.onclick = () => finalReveal(masikTaskaId);
            DOM.alkuElutasit.onclick = () => finalReveal(gameState.sajatTaska);
            DOM.dontesiTerulet.classList.remove('rejtett');
            gameState.allapot = 'dontes';
        }

        function finalReveal(nyertesTaskaId) {
            DOM.dontesiTerulet.classList.add('rejtett');
            const nyeremeny = gameState.taskaErtekek[nyertesTaskaId];
            mutassUzenetet(`Játék vége! A nyereményed: ${nyeremeny.display}!`);
            document.querySelectorAll('.taska:not(.nyitott)').forEach(t => t.classList.add('nyitott'));
            gameState.allapot = 'vege';
        }

        function alkuElutasitasa() {
            DOM.dontesiTerulet.classList.add('rejtett');
            gameState.aktualisKor++;
            gameState.megNyitando = nyitasiSzamlalo[gameState.aktualisKor] || 1;
            gameState.allapot = 'nyitogatas';
            mutassUzenetet(getRandomElem(uzenetek.alkuElutasitva), `Akkor nyiss ki ${gameState.megNyitando} táskát!`);
        }

        function alkuElfogadasa(ajanlatErtek) {
            DOM.dontesiTerulet.classList.add('rejtett');
            gameState.allapot = 'alku_elfogadva_nyitogatas';
            const ajanlatSzoveg = formatValuta(ajanlatErtek);
            mutassUzenetet(`MEGÁLLAPODÁS! Nyereményed: ${ajanlatSzoveg}.`, `Most kiderítheted, jól döntöttél-e. Nyisd ki a maradék táskákat, beleértve a sajátodat is!`);
        }
        
        function idoFrissites() {
            const now = new Date();
            DOM.pontosIdo.textContent = now.toLocaleTimeString('hu-HU');
            
            const msPer15Min = 15 * 60 * 1000;
            const kovetkezoIdopontMs = (Math.floor(now.getTime() / msPer15Min) + 1) * msPer15Min;
            const kovetkezoIdopont = new Date(kovetkezoIdopontMs);
            DOM.idoKovetkezo.textContent = `${String(kovetkezoIdopont.getHours()).padStart(2, '0')}:${String(kovetkezoIdopont.getMinutes()).padStart(2, '0')}`;
            
            if (getJelenlegiSeed() !== gameState.aktivJatekSeed) {
                if(gameState.allapot === 'vege' || gameState.allapot === 'kezdes_elott' || gameState.allapot === 'sajat_valasztas') {
                    init();
                } else {
                    DOM.keveresSzoveg.classList.add('rejtett');
                    DOM.frissitesGomb.classList.remove('rejtett');
                }
            }
        }

        DOM.frissitesGomb.addEventListener('click', init);
        setInterval(idoFrissites, 1000);
        init();
    </script>
</body>
</html>